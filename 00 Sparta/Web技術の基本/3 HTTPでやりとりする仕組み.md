# Chapter3 HTTPでやりとりする仕組み
## HTTPメッセージ  
- HTTPとはHTMLなどのテキストファイルや、画像などのコンテンツをやりとりする時に使われるプロトコル。
- HTTPではWebブラウザが要求を送り、Webサーバーがその要求に対して応答を返すやりとりを繰り返すことでWebサイトの閲覧を可能としている。
- HTTPリクエスト・・Webブラウザからの要求
- HTTPレスポンス・・Webサーバーの応答
## HTTPリクエスト
- Webブラウザからの要求であり、「リクエスト行」「メッセージヘッダー」「メッセージボディ」の3つに分けることができる。
[![Image from Gyazo](https://i.gyazo.com/f1e7a4d746bac73c6202782cdc6c5712.png)](https://gyazo.com/f1e7a4d746bac73c6202782cdc6c5712)
##  リクエストヘッダー（メッセージヘッダー）
-  Webブラウザーの種類やバージョン、対応するデータ形式など付加的な情報を記述している。
## リクエストボディ（メッセージボディ）
-  Webページ内のフォーム欄などに入力したテキストデータlなどをWebサーバーに送る目的で使用される。
## HTTPレスポンス
- WebブラウザからHTTPリクエストを受け取ったWebサーバーは、リクエストを処理して、その結果をHTTPレスポンスとして応答する。なお、「ステータス行」「メッセージヘッダー」「メッセージボディ」の3つに分けることができる。
[![Image from Gyazo](https://i.gyazo.com/a2e97b002303d154ee922d16284a9025.png)](https://gyazo.com/a2e97b002303d154ee922d16284a9025)
## レスポンスヘッダー（メッセージヘッダー）
-   Webサーバーの種類、送信するデータの形式などの付加的な情報を記述している。
## レスポンスボディ（メッセージボディ）
- WebブラウザからリクエストされたHTMLなどのデータを格納する。

## メソッド
- クライアントが Webサーバーに要求する処理の種類を表す。
- 「GET」 と「POST」の違い
どちらも Webサイトを閲覧する際に利用されるHTTPメソッドであるがデータの送信方法が異なる。
「GET」では
URLにデータが組み込まれる。そのためWebブラウザに閲覧履歴が残る。
「POST」では
メッセージボディ内にデータが組み込まれるため、閲覧履歴は残らない。
なので会員制サイトにログインする場合などの機密性を考慮する場合は「POST」メソッドを利用する。
## ステータスコード
- HTTPレスポンス内のHTTPリクエストに対するWebサーバー内での処理結果のこと。3桁の数字からなり、100番台から500番台までの5つに分類され、正常の場合は「200」、エラー画面で「ページが見つかりません」が表示される場合は「404」のステータスコードが返される。

## 検証から読み取る
- 下の画像は「GET」メソッドで、URL「https://tech-essentials.work/courses/1/tasks/1」　をブラウザーからリクエストして、レスポンスとしてステータスコード「200」が返ってきているので正常にサーバーからブラウザーに表示されたときの検証である。
[![Image from Gyazo](https://i.gyazo.com/fdd33b14073cffafecde33525b856291.png)](https://gyazo.com/fdd33b14073cffafecde33525b856291)


- （追記）なお、レスポンスボディはこちら。
[![Image from Gyazo](https://i.gyazo.com/18e9ffc54477facc1d1bad7de7de1935.png)](https://gyazo.com/18e9ffc54477facc1d1bad7de7de1935)

- 一方、「404」のステータスコードでは検証で下のように表示される。
[![Image from Gyazo](https://i.gyazo.com/8260e341fbcdfc96accb8006fe1d3ba1.png)](https://gyazo.com/8260e341fbcdfc96accb8006fe1d3ba1)

## TCPによるデータ通信
- TCPではクライアントとサーバーがお互いに通信ができる状態なのかを確認し、「コネクション」と呼ばれる通信経路を確立した上でデータのやりとりを行う。このコネクションは次の3つのやりとりにより行われる。
1. クライアントからの接続要求（SYN）・・SYNパケット
2. クライアントに対して確認応答及び、サーバーからの接続要求（SYN＋ACK）・・ACKパケット
3. サーバーに対して確認応答（ACK）
- コネクションの確立によりクライアントとサーバーがお互いに通信可能であると確認したうえでデータのやり取りが開始される。
## HTTP/1.1のやりとり
- HTTP1.1以降ではコネクションを継続して利用できるようにHTTPキープアライブという機能がついた。
- HTTPパイプラインと呼ばれる機能により、レスポンスを待つことなくリクエストを送信することが可能となり、効率化された。
## HTTP/2のやりとり
- ストリームという仮想的な通信経路を複数生成し、それぞれのストリーム内でHTTPリクエストとHTTPレスポンスのやりとりを可能としている。ここのストリームは独立しており並行してリクエストとレスポンスのやり取りができるようになり、レスポンス待ちがなくなり効率化された。
## HTTP/2での改良点
- バイナリ形式の利用
- ヘッダー圧縮
- サーバープッシュ
## HTTPSの仕組み
- HTTPSとはHTTPの通信において暗号化方式であるSSLやTLSを利用することでWebサイトを安全に使うことができる仕組み。
- 以下の3つにより安全性を確保する
1. 盗聴防止・・暗号化
2. 改ざん防止・・メッセージダイジェスト
3. なりすまし防止・・SSLサーバー証明書と認証局
## HTTPSのやり取り
- SSL/TLSハンドシェイクが完了してから通信を開始する。
- SSL/TLSハンドシェイクの4つのフェーズ
1. 暗号化の決定
2. 通信相手の証明
3. 鍵の交換
4. 暗号化方式の確認
## ステートフルとステートレス
- ステートフル・・毎回のやりとりをリセットして1話完結（サザエさん）
- ステートレス・・以前のやりとりを覚えて、ストーリー化（連続ドラマ）負担が大きい。
## Cookie
- Webサーバーに接続してきたWebブラウザに対して、コンテンツなどと一緒にWebブラウザに保存してほしい情報をCookieとして送る。
- Cookieの送信にはメッセージヘッダーが利用される。Webレスポンスには「Set-Cookie」ヘッダー、リクエストには「Cookie」ヘッダーを含めることで送信できる。
- セッションCookie・・有効期限が設定されていないCookieはWebブラウザが閉じられると同時に削除される。
- 有効期限が設定されたCookieはWebブラウザが閉じられても削除されないため、盗まれると他人になりすまされる可能性がある。
## セッション
- セッション・・WebブラウザとWebサーバーのやりとりにおいて一連の関連性のある処理の流れ
- セッションIDの渡し方
1. Cookieに含めて渡す
2. リンクのURLに埋め込む
3. フォームデータに埋め込む
## URI
- URI・・情報やデータといったリソースを識別するための記述方法。
